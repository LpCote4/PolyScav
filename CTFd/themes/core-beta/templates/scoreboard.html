{% extends "base.html" %}

{% block content %}
  <div class="jumbotron" style="padding: 1rem 1rem;">
    {% if Configs.ctf_banner %}
    <img class="mx-auto d-block" style="width: auto;padding-bottom: 25px;max-height: 20vw;" src="{{ url_for('views.files', path=Configs.ctf_banner) }}" />
    {% endif %}
    <div class="container">
      <h1>
        {% trans %}Scoreboard{% endtrans %}
      </h1>
      <p class="ctfd-event-countdown">&nbsp;</p>
    </div>
    {% if Configs.ctf_description %}
    <div class="container" style="padding-top: 10px;">
      {{ Configs.ctf_description }}
    </div>
    {% endif %}
  </div>
  
  <div class="container">
    {% include "components/errors.html" %}

    <div id="score-graph" class="score-graph" class="align-items-center w-100" style="display: flex; justify-content: center;flex-direction: column;" :class="{'d-flex': show, 'd-none': !show}" x-data="ScoreboardDetail" x-ref="scoregraph">
      
      <div id="leaderboard" :style="`--teamColor: ${top.color};`">
        <div class="ribbon"></div>
        
        <table >
          <template x-for="(ranking, index) in rankings">
          <tr>
            <td class="number" x-text="ranking.pos"></td>
            <td class="name" x-text="ranking.name"></td>
            <td class="points">
              <p  x-text="`${ranking.score}&nbsp`"></p>
              <p class="potentialscore"x-text="`(+${ranking.potential_score})`"></p>
              <template x-if="index == 0"><img  class="gold-medal" src="https://github.com/malunaridev/Challenges-iCodeThis/blob/master/4-leaderboard/assets/gold-medal.png?raw=true" alt="gold medal"/></template>
              <div class="splash" style="position: absolute;"><img  value="allo" :onload="`loserSplash(this, ${index})`"  src="/themes/core/static/img/splash1.png"></div>
            </td>
            
          </tr>
          </template>
        </table>
        <hr>
       
        
        
       
        
      </div>
      <div class="col-md-12 text-center" hidden>
        <i class="fas fa-circle-notch fa-spin fa-3x fa-fw spinner"></i>
      </div>
    </div>
    
    <div id="scoreboard" class="row" x-data="ScoreboardList">
      
        <template x-if="brackets.length && standings.length">
          <div class="col-md-12 py-3">
            <nav class="nav nav-pills nav-fill">
              <button :class="{'nav-link': true, 'active': !activeBracket}" @click="activeBracket=null">{% trans %}All{% endtrans %}</button>
              <template x-for="bracket in brackets">
                <button :class="{'nav-link': true, 'active': activeBracket == bracket.id}" x-text="bracket.name" @click="activeBracket=bracket.id"></button>
              </template>
            </nav>
          </div>
        </template>

        <div class="col-md-12" x-show="standings.length">
          
          <div class="container imageShownDown" style="display:grid;row-gap: 20px;width: 100%; max-height: 100%; justify-content: center;align-items: center;margin: auto;">
           
              <tbody id="challengeRecap">
                
                <template x-for="(standing, index) in standings.filter(i => activeBracket ? i.bracket_id==activeBracket : true)" style="z-index:2;">
                  <div  :id="standing.provided" x-data="{id: standing.provided, team_id: standing.team_id, challenge_id: standing.challenge_id, type:standing.type, color:standing.color,index:index}"  :style="`justify-self:center;background-color: ${color} !important;display:flex; width:100%;max-width:200px; height:fit-content;flex-direction: column;border-radius: 15px;grid-row-start: ${index+1};grid-row-end: ${index+3};grid-column-start: auto;grid-column-end: auto;`">
                   
                    <div class="header" :style="`display: flex;justify-content: space-between;text-align: center;align-items: center;z-index: 3;background-color: ${color};border-top-left-radius:15px;border-top-right-radius:15px`">
                      <div style="width: 40%;align-items: center;display: flex;justify-content: space-around;">
                        <p style="font-size: 7px;width: 7ch;height: 1px;text-align: center;z-index: 3;vertical-align: middle;padding-top: -1px;font-family: Raleway, sans-serif;font-weight: bolder;" x-text="standing.time"></p>
                      </div>
                      
                      <div class="lineStart" :style="`background-color: ${color};width: 45px;height: 45px;margin: -45px;border-radius: 100%;left: 30%; z-index: 0;`" :value="color">
                        <canvas class="lineCanvas"  style="position: absolute;left: 0%;right: 0%;z-index: -2;pointer-events: none;"></canvas>
                        <b style="position: relative;top: 25%;width: 100%;height: 100%;color: white;font-weight:bolder;z-index: 2;" x-text="standing.value"></b>
                      </div>
                      <div style="width: 40%;text-align: end;">
                        <p style="font-size: 10px;font-family: Raleway, sans-serif;text-overflow: ellipsis;height: 0px;font-weight:bolder;padding-right: 3px; " x-text="standing.user_name"></p>
                      </div>
                      
                    </div>
                    <div class="content" style="align-items: center;width: 100%;z-index: 2;"><div :style="`align-items: center;min-width: fit-content;z-index: 2;opacity: 1;background-color: ${color};`"  x-text=" " x-data="LogImage" class="imageContainer"></div></div>
                    <div class="header" style="display: flex;font-family: Raleway, sans-serif;align-items: center;text-align: center;width: 100%;display: flex;justify-content: center; z-index: 2;"><p style="font-size: 12px;font-family: Raleway, sans-serif;font-weight:bolder;text-align: center; max-width: 130px; z-index: 2;" x-text="standing.challenge_name"></p></div>
                    
                   
                    <!-- 
                    <th scope="row" class="text-center" x-text="standing.time"></th>
                    <td style="padding-left: 2% !important;">
                      <div><b><p style="width: 15ch;overflow: hidden;text-overflow: ellipsis;" x-text="'Par: ' + standing.user_name"></p></b>
                        <p></p>
                       <b> <p :href="standing.account_id" style="width: 15ch;overflow: hidden;text-overflow: ellipsis;" x-text="'Dans l\'Ã©quipe: '+standing.team_name" ></p></b></div>
                      
                      
                    </td>
                    <td x-text="standing.challenge_name" class="challenge_name"></td>
                    <td class="award-icon" hidden style="width: 100%; height: 104.8px; display: block; position: relative;">
                      <i class="fas fa-trophy" style="color: gold; width: 100%; height: 104.8px; display: flex; justify-content: center; align-items: center;"></i>
                    </td>
                    
                    <td x-data="LogImage" class="imageContainer"></td>
                    <td x-text="standing.value"></td>
                    -->
                    <div class="splash" :style="`--teamColor: ${color};z-index:1;`"><img  src="/themes/core-beta/static/img/splash1.png"></div>
                    <div class="splash" :style="`--teamColor: ${color};z-index:1;`"><img  src="/themes/core-beta/static/img/splash1.png"></div>
                    <div class="splash" :style="`--teamColor: ${color};z-index:1;`"><img  src="/themes/core-beta/static/img/splash1.png"></div>
                  </div>
                  
                </template>
                
              </tbody>  
              
          </div>
          <button class="btn btn-primary" id="plus-btn" style="position: relative; bottom: -20px; left: 45%;" @click="showXMore">plus...</button>
          
        </div>
        
      <div class="col-md-12" x-show="! standings.length">
        <h3 class="text-center text-muted">{% trans %}Scoreboard is empty{% endtrans %}</h3>
      </div>
    </div>
    <div ></div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ Assets.js("assets/js/scoreboard.js") }}
{% endblock %}
